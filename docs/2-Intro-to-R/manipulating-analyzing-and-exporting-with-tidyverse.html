<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.269">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="In this lesson we will use tidyverse packages to manipulate and analyze data. We’ll perform similar subsetting processes as before, but with tidyverse tools. Then we’ll exploring linking input and outputs. We’ll also get into the subject of reshaping and formatting data before we end with exporting data.">

<title>A resource for self-guided learning - Manipulating, analyzing, and exporting data with tidyverse</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../2-Intro-to-R/data-visualization.html" rel="next">
<link href="../2-Intro-to-R/starting-with-data.html" rel="prev">
<script src="../site_libs/cookie-consent/cookie-consent.js"></script>
<link href="../site_libs/cookie-consent/cookie-consent.css" rel="stylesheet">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script async="" src="https://www.googletagmanager.com/gtag/js?id=G-DQ7RX0NWYQ"></script>

<script type="text/plain" cookie-consent="tracking">

window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-DQ7RX0NWYQ', { 'anonymize_ip': true});
</script>

<script type="text/javascript" charset="UTF-8">
document.addEventListener('DOMContentLoaded', function () {
cookieconsent.run({
  "notice_banner_type":"simple",
  "consent_type":"implied",
  "palette":"light",
  "language":"en",
  "page_load_consent_levels":["strictly-necessary","functionality","tracking","targeting"],
  "notice_banner_reject_button_hide":false,
  "preferences_center_close_button_hide":false,
  "website_name":""
  });
});
</script> 
  
<style>html{ scroll-behavior: smooth; }</style>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-sidebar docked nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">A resource for self-guided learning</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../getting-started.html">
 <span class="menu-text">Getting Started</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../software-installs.html">
 <span class="menu-text">Software Installs</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../learning-resources.html">
 <span class="menu-text">Learning Resource List</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../domain-specific-series.html">
 <span class="menu-text">Domain-Specific Series</span></a>
  </li>  
</ul>
              <div class="quarto-toggle-container">
                  <a href="" class="quarto-reader-toggle nav-link" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
              </div>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Manipulating, analyzing, and exporting data with tidyverse</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-full page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">The Unix Shell</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/series-introduction.html" class="sidebar-item-text sidebar-link">Series Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/installation.html" class="sidebar-item-text sidebar-link">Installation and Resources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/introducing-the-shell.html" class="sidebar-item-text sidebar-link">Introducing the Shell</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/the-file-system.html" class="sidebar-item-text sidebar-link">The File System</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/patterns-filters-and-pipes.html" class="sidebar-item-text sidebar-link">Patterns, Filters, and Pipes</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/variables-and-loops.html" class="sidebar-item-text sidebar-link">Variables and Loops</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../0-The-Unix-Shell/bash-scripting.html" class="sidebar-item-text sidebar-link">Bash Scripting</a>
  </div>
</li>
      </ul>
  </li>
        <li class="px-0"><hr class="sidebar-divider hi "></li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">R Data Analysis and Visualization</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2-Intro-to-R/series-introduction.html" class="sidebar-item-text sidebar-link">Series Introduction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2-Intro-to-R/installation.html" class="sidebar-item-text sidebar-link">Installation and Resources</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2-Intro-to-R/introduction-to-r-and-rstudio.html" class="sidebar-item-text sidebar-link">Introduction to R and RStudio</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2-Intro-to-R/starting-with-data.html" class="sidebar-item-text sidebar-link">Starting with data</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2-Intro-to-R/manipulating-analyzing-and-exporting-with-tidyverse.html" class="sidebar-item-text sidebar-link active">Manipulating, analyzing, and exporting data with tidyverse</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../2-Intro-to-R/data-visualization.html" class="sidebar-item-text sidebar-link">Data visualization with ggplot2</a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#data-manipulation-using-dpylr-and-tidyr" id="toc-data-manipulation-using-dpylr-and-tidyr" class="nav-link active" data-scroll-target="#data-manipulation-using-dpylr-and-tidyr">Data manipulation using <code>dpylr</code> and <code>tidyr</code></a></li>
  <li><a href="#selecting-columns-and-filtering-rows" id="toc-selecting-columns-and-filtering-rows" class="nav-link" data-scroll-target="#selecting-columns-and-filtering-rows">Selecting columns and filtering rows</a></li>
  <li><a href="#connecting-inputs-and-outputs-with-pipes" id="toc-connecting-inputs-and-outputs-with-pipes" class="nav-link" data-scroll-target="#connecting-inputs-and-outputs-with-pipes">Connecting inputs and outputs with pipes</a>
  <ul>
  <li><a href="#challenge" id="toc-challenge" class="nav-link" data-scroll-target="#challenge">Challenge</a></li>
  </ul></li>
  <li><a href="#mutate" id="toc-mutate" class="nav-link" data-scroll-target="#mutate">Mutate</a>
  <ul>
  <li><a href="#challenge-1" id="toc-challenge-1" class="nav-link" data-scroll-target="#challenge-1">Challenge</a></li>
  </ul></li>
  <li><a href="#split-apply-combine-data-analysis-and-the-summarize-function" id="toc-split-apply-combine-data-analysis-and-the-summarize-function" class="nav-link" data-scroll-target="#split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the <code>summarize()</code> function</a>
  <ul>
  <li><a href="#the-group_by-and-summarize-functions" id="toc-the-group_by-and-summarize-functions" class="nav-link" data-scroll-target="#the-group_by-and-summarize-functions">The <code>group_by()</code> and <code>summarize()</code> functions</a></li>
  </ul></li>
  <li><a href="#counting" id="toc-counting" class="nav-link" data-scroll-target="#counting">Counting</a>
  <ul>
  <li><a href="#challenge-2" id="toc-challenge-2" class="nav-link" data-scroll-target="#challenge-2">Challenge</a></li>
  <li><a href="#challenge-3" id="toc-challenge-3" class="nav-link" data-scroll-target="#challenge-3">Challenge</a></li>
  <li><a href="#challenge-4" id="toc-challenge-4" class="nav-link" data-scroll-target="#challenge-4">Challenge</a></li>
  </ul></li>
  <li><a href="#tidy-data" id="toc-tidy-data" class="nav-link" data-scroll-target="#tidy-data">Tidy data</a></li>
  <li><a href="#reshaping-with-pivot_longer-and-pivot_wider" id="toc-reshaping-with-pivot_longer-and-pivot_wider" class="nav-link" data-scroll-target="#reshaping-with-pivot_longer-and-pivot_wider">Reshaping with <code>pivot_longer()</code> and <code>pivot_wider()</code></a>
  <ul>
  <li><a href="#pivoting-from-long-to-wide-format" id="toc-pivoting-from-long-to-wide-format" class="nav-link" data-scroll-target="#pivoting-from-long-to-wide-format">Pivoting from long to wide format</a></li>
  <li><a href="#pivoting-from-wide-to-long-format" id="toc-pivoting-from-wide-to-long-format" class="nav-link" data-scroll-target="#pivoting-from-wide-to-long-format">Pivoting from wide to long format</a></li>
  <li><a href="#challenge-5" id="toc-challenge-5" class="nav-link" data-scroll-target="#challenge-5">Challenge</a></li>
  <li><a href="#challenge-6" id="toc-challenge-6" class="nav-link" data-scroll-target="#challenge-6">Challenge</a></li>
  </ul></li>
  <li><a href="#exporting-data" id="toc-exporting-data" class="nav-link" data-scroll-target="#exporting-data">Exporting data</a></li>
  <li><a href="#citations" id="toc-citations" class="nav-link" data-scroll-target="#citations">Citations</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content column-body" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Manipulating, analyzing, and exporting data with tidyverse</h1>
</div>

<div>
  <div class="description">
    In this lesson we will use tidyverse packages to manipulate and analyze data. We’ll perform similar subsetting processes as before, but with tidyverse tools. Then we’ll exploring linking input and outputs. We’ll also get into the subject of reshaping and formatting data before we end with exporting data.
  </div>
</div>


<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<section id="data-manipulation-using-dpylr-and-tidyr" class="level3">
<h3 class="anchored" data-anchor-id="data-manipulation-using-dpylr-and-tidyr">Data manipulation using <code>dpylr</code> and <code>tidyr</code></h3>
<p>We’ve learned to subset with brackets <code>[]</code>, which is useful, but can become cumbersome with complex subsetting operations. Enter the two packages below, both of which are part of the <code>tidyverse</code>.</p>
<ul>
<li><code>dplyr</code> – a package that is useful for tabular data manipulation</li>
<li><code>tidyr</code> – a package that is useful for donverting between data formats used in plotting / analysis</li>
</ul>
<p>The <strong><code>tidyverse</code></strong> package tries to address 3 common issues that arise when doing data analysis in <code>R</code>:</p>
<ol type="1">
<li>The results from a base <code>R</code> function sometimes depend on the type of data.</li>
<li><code>R</code> expressions are used in a non standard way, which can be confusing for new learners.</li>
<li>The existence of hidden arguments having default operations that new learners are not aware of.</li>
</ol>
<div class="callout-note callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>You should have <code>tidyverse</code> installed already. If you do not, you can type the following into the console.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install the package</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load the package</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(<span class="st">"tidyverse"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching packages ─────────────────────────────────────── tidyverse 1.3.2 ──
✔ ggplot2 3.4.0      ✔ purrr   0.3.5 
✔ tibble  3.1.8      ✔ dplyr   1.0.10
✔ tidyr   1.2.1      ✔ stringr 1.4.1 
✔ readr   2.1.3      ✔ forcats 0.5.2 
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()</code></pre>
</div>
</div>
</div>
</div>
<hr>
<p>Let’s read in our data using <code>read_csv()</code>, from the <code>tidyverse</code> package, <code>readr</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="st">"~/data-carpentry/data_raw/portal_data_joined.csv"</span>) <span class="co">#read in data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 34786 Columns: 13
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (6): species_id, sex, genus, species, taxa, plot_type
dbl (7): record_id, month, day, year, plot_id, hindfoot_length, weight

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(surveys) <span class="co">#inspect the data</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">view</span>(surveys) <span class="co">#preview the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>Next, we’re going to learn some of the most common <code>dplyr</code> functions</p>
<ul>
<li><code>select()</code>: subset columns</li>
<li><code>filter()</code>: subset rows on conditions</li>
<li><code>mutate()</code>: create new columns by using information from other columns</li>
<li><code>group_by()</code> and <code>summarize()</code>: create summary statistics on grouped data</li>
<li><code>arrange()</code>: sort results</li>
<li><code>count()</code>: count discrete values</li>
</ul>
<hr>
</section>
<section id="selecting-columns-and-filtering-rows" class="level3">
<h3 class="anchored" data-anchor-id="selecting-columns-and-filtering-rows">Selecting columns and filtering rows</h3>
<p>To select columns of a dataframe, we use <code>select()</code>.</p>
<p><code>select(datafame, columns_to_keep)</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(surveys, plot_id, species_id, weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34,786 × 3
   plot_id species_id weight
     &lt;dbl&gt; &lt;chr&gt;       &lt;dbl&gt;
 1       2 NL             NA
 2       2 NL             NA
 3       2 NL             NA
 4       2 NL             NA
 5       2 NL             NA
 6       2 NL             NA
 7       2 NL             NA
 8       2 NL             NA
 9       2 NL            218
10       2 NL             NA
# … with 34,776 more rows</code></pre>
</div>
</div>
<hr>
<p>To EXCLUDE a specific column, put <code>-</code> in front of the variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(surveys, <span class="sc">-</span>record_id, <span class="sc">-</span>species_id)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34,786 × 11
   month   day  year plot_id sex   hindfoot…¹ weight genus species taxa  plot_…²
   &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;      &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;  
 1     7    16  1977       2 M             32     NA Neot… albigu… Rode… Control
 2     8    19  1977       2 M             31     NA Neot… albigu… Rode… Control
 3     9    13  1977       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
 4    10    16  1977       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
 5    11    12  1977       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
 6    11    12  1977       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
 7    12    10  1977       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
 8     1     8  1978       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
 9     2    18  1978       2 M             NA    218 Neot… albigu… Rode… Control
10     3    11  1978       2 &lt;NA&gt;          NA     NA Neot… albigu… Rode… Control
# … with 34,776 more rows, and abbreviated variable names ¹​hindfoot_length,
#   ²​plot_type</code></pre>
</div>
</div>
<hr>
<p>To choose specific rows based on criteria, we use <code>filter()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">filter</span>(surveys, year <span class="sc">==</span> <span class="dv">1995</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 1,180 × 13
   record…¹ month   day  year plot_id speci…² sex   hindf…³ weight genus species
      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
 1    22314     6     7  1995       2 NL      M          34     NA Neot… albigu…
 2    22728     9    23  1995       2 NL      F          32    165 Neot… albigu…
 3    22899    10    28  1995       2 NL      F          32    171 Neot… albigu…
 4    23032    12     2  1995       2 NL      F          33     NA Neot… albigu…
 5    22003     1    11  1995       2 DM      M          37     41 Dipo… merria…
 6    22042     2     4  1995       2 DM      F          36     45 Dipo… merria…
 7    22044     2     4  1995       2 DM      M          37     46 Dipo… merria…
 8    22105     3     4  1995       2 DM      F          37     49 Dipo… merria…
 9    22109     3     4  1995       2 DM      M          37     46 Dipo… merria…
10    22168     4     1  1995       2 DM      M          36     48 Dipo… merria…
# … with 1,170 more rows, 2 more variables: taxa &lt;chr&gt;, plot_type &lt;chr&gt;, and
#   abbreviated variable names ¹​record_id, ²​species_id, ³​hindfoot_length</code></pre>
</div>
</div>
<hr>
</section>
<section id="connecting-inputs-and-outputs-with-pipes" class="level3">
<h3 class="anchored" data-anchor-id="connecting-inputs-and-outputs-with-pipes">Connecting inputs and outputs with pipes</h3>
<p>We often want to perform multiple manipulations to our datasets. This can be done in a few ways: intermediate steps, nested functions, or pipes.</p>
<p>With intermediate steps, a temporary dataframe is created and used as input into the next function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>surveys2 <span class="ot">&lt;-</span> <span class="fu">filter</span>(surveys, weight <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="co">#filer surveys to create surveys2, the intermediate file</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>surveys_sml <span class="ot">&lt;-</span> <span class="fu">select</span>(surveys2, species_id, sex, weight) <span class="co">#use surveys2 as input for the next step </span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>While sometimes useful (for initial validation, etc.), this can clutter the workspace and make it difficult to follow.</p>
<hr>
<p>Nested functions fit one function inside of another.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>surveys_sml <span class="ot">&lt;-</span> <span class="fu">select</span>(<span class="fu">filter</span>(surveys, weight <span class="sc">&lt;</span> <span class="dv">5</span>), species_id, sex, weight) <span class="co"># filtering first, then selecting</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This is handy, but can be difficult to read if too many functions are nested, as <code>R</code> evaluates the expression from the inside out (in this case, filtering, then selecting).</p>
<hr>
<p>Pipes (<code>%&gt;%</code>) are a recent addition to <code>R</code> and let you take the output of one function and send it directly to the next function as input. The package enabling this is <code>magrittr</code>, installed when you install <code>dplyr</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span> <span class="co"># send surveys to filter</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weight <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span> <span class="co"># use surveys as input, filter and send output to select</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species_id, sex, weight) <span class="co"># use filtered data as input, select, and send output to console</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 17 × 3
   species_id sex   weight
   &lt;chr&gt;      &lt;chr&gt;  &lt;dbl&gt;
 1 PF         F          4
 2 PF         F          4
 3 PF         M          4
 4 RM         F          4
 5 RM         M          4
 6 PF         &lt;NA&gt;       4
 7 PP         M          4
 8 RM         M          4
 9 RM         M          4
10 RM         M          4
11 PF         M          4
12 PF         F          4
13 RM         M          4
14 RM         M          4
15 RM         F          4
16 RM         M          4
17 RM         M          4</code></pre>
</div>
</div>
<p>Let’s break it down a bit.</p>
<ol type="1">
<li>We use the pipe to send the <code>surveys</code> dataset through <code>filter()</code></li>
<li>Filter takes that input, and performs the filtering to keep rows where <code>weight</code> is less than 5, then send the output to select</li>
<li>Select takes that input, and keeps only the <code>species_id</code>, <code>sex</code>, and <code>weight</code> columns.</li>
</ol>
<p>Note that since <code>%&gt;%</code> takesthe object on its left and passes it as the first argument to the function on its right, we don’t need to explicitly include the data frame as an argument to the <code>filter()</code> and <code>select()</code> functions any more.</p>
<div class="callout-tip callout callout-style-default callout-captioned">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>Some may find it helpful to read the pipe like the word “then.” For instance, in the example above, we took the dataframe <code>surveys</code>, <em>then</em> we <code>filter</code>ed for rows with <code>weight &lt; 5</code>, <em>then</em> we <code>select</code>ed columns <code>species_id</code>, <code>sex</code>, and <code>weight</code>. The <code>dplyr</code> functions by themselves are somewhat simple, but by combining them into linear workflows with the pipe we can accomplish more complex manipulations of dataframes.</p>
</div>
</div>
<hr>
<p>If we want to create a new object with this smaller version of the data, we can assign it a new name using the assignment operator.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>surveys_sml <span class="ot">&lt;-</span> surveys <span class="sc">%&gt;%</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(weight <span class="sc">&lt;</span> <span class="dv">5</span>) <span class="sc">%&gt;%</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(species_id, sex, weight)</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>surveys_sml</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Note that the final dataframe is the leftmost part of this expression.</p>
<hr>
<section id="challenge" class="level4">
<h4 class="anchored" data-anchor-id="challenge">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Using pipes, subset the <code>surveys</code> data to include animals collected before 1995 and retain only the columns <code>year</code>, <code>sex</code>, and <code>weight</code>.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-3-contents" aria-controls="callout-3" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-3" class="callout-3-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(year <span class="sc">&lt;</span> <span class="dv">1995</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year, sex, weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 21,486 × 3
    year sex   weight
   &lt;dbl&gt; &lt;chr&gt;  &lt;dbl&gt;
 1  1977 M         NA
 2  1977 M         NA
 3  1977 &lt;NA&gt;      NA
 4  1977 &lt;NA&gt;      NA
 5  1977 &lt;NA&gt;      NA
 6  1977 &lt;NA&gt;      NA
 7  1977 &lt;NA&gt;      NA
 8  1978 &lt;NA&gt;      NA
 9  1978 M        218
10  1978 &lt;NA&gt;      NA
# … with 21,476 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="mutate" class="level3">
<h3 class="anchored" data-anchor-id="mutate">Mutate</h3>
<p>Frequently you’ll want to create new columns based on the values in existing columns, for example to do unit conversions, or to find the ratio of values in two columns. For this we’ll use <code>mutate()</code>.</p>
<p>To create a new column of weight in kg</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> weight <span class="sc">/</span> <span class="dv">1000</span>) <span class="co">#assign the column name to the left of the "="</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34,786 × 14
   record…¹ month   day  year plot_id speci…² sex   hindf…³ weight genus species
      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
 1        1     7    16  1977       2 NL      M          32     NA Neot… albigu…
 2       72     8    19  1977       2 NL      M          31     NA Neot… albigu…
 3      224     9    13  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 4      266    10    16  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 5      349    11    12  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 6      363    11    12  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 7      435    12    10  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 8      506     1     8  1978       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 9      588     2    18  1978       2 NL      M          NA    218 Neot… albigu…
10      661     3    11  1978       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
# … with 34,776 more rows, 3 more variables: taxa &lt;chr&gt;, plot_type &lt;chr&gt;,
#   weight_kg &lt;dbl&gt;, and abbreviated variable names ¹​record_id, ²​species_id,
#   ³​hindfoot_length</code></pre>
</div>
</div>
<hr>
<p>You can also create a second new column based on the first new column within the same call of <code>mutate()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> weight <span class="sc">/</span> <span class="dv">1000</span>,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">weight_lb =</span> weight_kg <span class="sc">*</span> <span class="fl">2.2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 34,786 × 15
   record…¹ month   day  year plot_id speci…² sex   hindf…³ weight genus species
      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
 1        1     7    16  1977       2 NL      M          32     NA Neot… albigu…
 2       72     8    19  1977       2 NL      M          31     NA Neot… albigu…
 3      224     9    13  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 4      266    10    16  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 5      349    11    12  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 6      363    11    12  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 7      435    12    10  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 8      506     1     8  1978       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
 9      588     2    18  1978       2 NL      M          NA    218 Neot… albigu…
10      661     3    11  1978       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
# … with 34,776 more rows, 4 more variables: taxa &lt;chr&gt;, plot_type &lt;chr&gt;,
#   weight_kg &lt;dbl&gt;, weight_lb &lt;dbl&gt;, and abbreviated variable names
#   ¹​record_id, ²​species_id, ³​hindfoot_length</code></pre>
</div>
</div>
<hr>
<p>If this runs off your screen and you just want to see the first few rows, you can use a pipe to view the <code>head()</code> of the data. (Pipes work with non-<code>dplyr</code> functions, too, as long as the <code>dplyr</code> or <code>magrittr</code> package is loaded).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> weight <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  record_id month   day  year plot_id speci…¹ sex   hindf…² weight genus species
      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
1         1     7    16  1977       2 NL      M          32     NA Neot… albigu…
2        72     8    19  1977       2 NL      M          31     NA Neot… albigu…
3       224     9    13  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
4       266    10    16  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
5       349    11    12  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
6       363    11    12  1977       2 NL      &lt;NA&gt;       NA     NA Neot… albigu…
# … with 3 more variables: taxa &lt;chr&gt;, plot_type &lt;chr&gt;, weight_kg &lt;dbl&gt;, and
#   abbreviated variable names ¹​species_id, ²​hindfoot_length</code></pre>
</div>
</div>
<hr>
<p>The first few rows of the output are full of <code>NA</code>s, so if we wanted to remove those we could insert a <code>filter()</code> in the chain, using the <code>!is.na()</code> approach we used in past sessions.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weight_kg =</span> weight <span class="sc">/</span> <span class="dv">1000</span>) <span class="sc">%&gt;%</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">head</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 14
  record_id month   day  year plot_id speci…¹ sex   hindf…² weight genus species
      &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;  
1       588     2    18  1978       2 NL      M          NA    218 Neot… albigu…
2       845     5     6  1978       2 NL      M          32    204 Neot… albigu…
3       990     6     9  1978       2 NL      M          NA    200 Neot… albigu…
4      1164     8     5  1978       2 NL      M          34    199 Neot… albigu…
5      1261     9     4  1978       2 NL      M          32    197 Neot… albigu…
6      1453    11     5  1978       2 NL      M          NA    218 Neot… albigu…
# … with 3 more variables: taxa &lt;chr&gt;, plot_type &lt;chr&gt;, weight_kg &lt;dbl&gt;, and
#   abbreviated variable names ¹​species_id, ²​hindfoot_length</code></pre>
</div>
</div>
<hr>
<section id="challenge-1" class="level4">
<h4 class="anchored" data-anchor-id="challenge-1">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Create a new data frame from the <code>surveys</code> data that meets the following criteria:</p>
<p>Contains only the <code>species_id</code> column and a new column called <code>hindfoot_cm</code> containing the <code>hindfoot_length</code> values (currently in mm) converted to centimeters.</p>
<p>In this <code>hindfoot_cm</code> column, there are no <code>NA</code>s and all values are less than 3.</p>
<p>Hint: think about how the commands should be ordered to produce this data frame!</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-4-contents" aria-controls="callout-4" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-4" class="callout-4-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>surveys_hindfoot_cm <span class="ot">&lt;-</span> surveys <span class="sc">%&gt;%</span> <span class="co"># save to new object, pass surveys to filter</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(hindfoot_length)) <span class="sc">%&gt;%</span> <span class="co">#filter out rows with NAs in the hindfoot_length column, pass on</span></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">hindfoot_cm =</span> hindfoot_length <span class="sc">/</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> <span class="co"># convert hindfoot_length from mm to cm, save as new column hindfoot_cm, pass on</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(hindfoot_cm <span class="sc">&lt;</span> <span class="dv">3</span>) <span class="sc">%&gt;%</span> <span class="co"># filter out rows, keeping those where hindfoot_cm is less than 3</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(species_id, hindfoot_cm) <span class="co"># select the species_id and hindfoot_cm columns</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="split-apply-combine-data-analysis-and-the-summarize-function" class="level3">
<h3 class="anchored" data-anchor-id="split-apply-combine-data-analysis-and-the-summarize-function">Split-apply-combine data analysis and the <code>summarize()</code> function</h3>
<p>Many data analysis tasks can be approached using the <em>split-apply-combine</em> paradigm:</p>
<ul>
<li>split the data into groups</li>
<li>apply some analysis to each group</li>
<li>and then combine the results.</li>
</ul>
<p>Key functions of <code>dplyr</code> for this workflow are <code>group_by()</code> and <code>summarize()</code></p>
<hr>
<section id="the-group_by-and-summarize-functions" class="level4">
<h4 class="anchored" data-anchor-id="the-group_by-and-summarize-functions">The <code>group_by()</code> and <code>summarize()</code> functions</h4>
<p><code>group_by()</code> is often used together with <code>summarize()</code>, which collapses each group into a single-row summary of that group</p>
<p><code>group_by()</code> takes as arguments the column names that contain the <strong>categorical</strong> variables for which you want to calculate the summary statistics.</p>
<p>So to compute the mean <code>weight</code> by sex</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span> <span class="co"># group by values categorical sex column</span></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="co"># calculate the mean weight for each category in the sex column, save as a new column mean_weight, then summarize</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  sex   mean_weight
  &lt;chr&gt;       &lt;dbl&gt;
1 F            42.2
2 M            43.0
3 &lt;NA&gt;         64.7</code></pre>
</div>
</div>
<p>Notice that we can pass summarize a column name – so it’s almost like saying “give me a tibble with this column that is this values/computational output”.</p>
<hr>
<p>You can also group by multiple columns.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, species_id) <span class="sc">%&gt;%</span> <span class="co"># create more granular groups of sex, species_id combined</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tail</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'sex'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   sex [1]
  sex   species_id mean_weight
  &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;
1 &lt;NA&gt;  SU                 NaN
2 &lt;NA&gt;  UL                 NaN
3 &lt;NA&gt;  UP                 NaN
4 &lt;NA&gt;  UR                 NaN
5 &lt;NA&gt;  US                 NaN
6 &lt;NA&gt;  ZL                 NaN</code></pre>
</div>
</div>
<p>Here, we used <code>tail()</code> to look at the last six rows of our summary. Before, we had used <code>head()</code> to look at the first six rows.</p>
<hr>
<p>We can see that the <code>sex</code> column contains <code>NA</code> values. The resulting <code>mean_weight</code> column does not contain <code>NA</code> but <code>NaN</code> (which refers to “Not a Number”) because <code>mean()</code> was called on a vector of <code>NA</code> values while at the same time setting <code>na.rm = TRUE</code> (we didn’t filter out the rows, we just omitted the <code>NA</code>s from the calculation).</p>
<p>To avoid this, we can remove the missing values for weight before we attempt to calculate the summary statistics on weight. Because the missing values are removed first, we can omit <code>na.rm = TRUE</code> when computing the mean.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, species_id) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'sex'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64 × 3
# Groups:   sex [3]
   sex   species_id mean_weight
   &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;
 1 F     BA                9.16
 2 F     DM               41.6 
 3 F     DO               48.5 
 4 F     DS              118.  
 5 F     NL              154.  
 6 F     OL               31.1 
 7 F     OT               24.8 
 8 F     OX               21   
 9 F     PB               30.2 
10 F     PE               22.8 
# … with 54 more rows</code></pre>
</div>
</div>
<hr>
<p>Once the data are grouped, you can also summarize multiple variables at the same time (and not necessarily on the same variable).</p>
<p>For instance, we could add a column indicating the minimum weight for each species for each sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, species_id) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight),</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_weight =</span> <span class="fu">min</span>(weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'sex'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64 × 4
# Groups:   sex [3]
   sex   species_id mean_weight min_weight
   &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;
 1 F     BA                9.16          6
 2 F     DM               41.6          10
 3 F     DO               48.5          12
 4 F     DS              118.           45
 5 F     NL              154.           32
 6 F     OL               31.1          10
 7 F     OT               24.8           5
 8 F     OX               21            20
 9 F     PB               30.2          12
10 F     PE               22.8          11
# … with 54 more rows</code></pre>
</div>
</div>
<hr>
<p>We can also arrange the data.</p>
<p>For example, let’s sort (low to high value) on <code>min_weight</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, species_id) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight),</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_weight =</span> <span class="fu">min</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(min_weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'sex'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64 × 4
# Groups:   sex [3]
   sex   species_id mean_weight min_weight
   &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;
 1 F     PF                7.97          4
 2 F     RM               11.1           4
 3 M     PF                7.89          4
 4 M     PP               17.2           4
 5 M     RM               10.1           4
 6 &lt;NA&gt;  PF                6             4
 7 F     OT               24.8           5
 8 F     PP               17.2           5
 9 F     BA                9.16          6
10 M     BA                7.36          6
# … with 54 more rows</code></pre>
</div>
</div>
<hr>
<p>We can sort in descending order by using the <code>desc()</code> function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(sex, species_id) <span class="sc">%&gt;%</span></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight),</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min_weight =</span> <span class="fu">min</span>(weight)) <span class="sc">%&gt;%</span></span>
<span id="cb43-6"><a href="#cb43-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(mean_weight))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'sex'. You can override using the `.groups`
argument.</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 64 × 4
# Groups:   sex [3]
   sex   species_id mean_weight min_weight
   &lt;chr&gt; &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt;
 1 &lt;NA&gt;  NL               168.          83
 2 M     NL               166.          30
 3 F     NL               154.          32
 4 M     SS               130          130
 5 &lt;NA&gt;  SH               130          130
 6 M     DS               122.          12
 7 &lt;NA&gt;  DS               120           78
 8 F     DS               118.          45
 9 F     SH                78.8         30
10 F     SF                69           46
# … with 54 more rows</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="counting" class="level3">
<h3 class="anchored" data-anchor-id="counting">Counting</h3>
<p>We often want to count the number of observations found for each factor or a combination of factors. For this, we use <code>count()</code>.</p>
<p>Let’s count the number of rows of data for each sex.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(sex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  sex       n
  &lt;chr&gt; &lt;int&gt;
1 F     15690
2 M     17348
3 &lt;NA&gt;   1748</code></pre>
</div>
</div>
<p>The <code>count()</code> function is shorthand for something we’ve already seen: grouping by a variable, and summarizing it by counting the number of observations in that group. In other words, <code>surveys %&gt;% count()</code> is equivalent to</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(sex) <span class="sc">%&gt;%</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">count =</span> <span class="fu">n</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  sex   count
  &lt;chr&gt; &lt;int&gt;
1 F     15690
2 M     17348
3 &lt;NA&gt;   1748</code></pre>
</div>
</div>
<hr>
<p>For convenience, <code>count()</code> provides the <code>sort</code> argument.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(sex, <span class="at">sort =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 3 × 2
  sex       n
  &lt;chr&gt; &lt;int&gt;
1 M     17348
2 F     15690
3 &lt;NA&gt;   1748</code></pre>
</div>
</div>
<hr>
<p>Previous example shows the use of <code>count()</code> to count the number of rows/observations for <em>one</em> factor (i.e., <code>sex</code>).</p>
<p>If we wanted to count <em>combination of factors</em>, such as <code>sex</code> and <code>species</code>, we would specify the first and the second factor as the arguments of <code>count()</code></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, species)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 81 × 3
   sex   species         n
   &lt;chr&gt; &lt;chr&gt;       &lt;int&gt;
 1 F     albigula      675
 2 F     baileyi      1646
 3 F     eremicus      579
 4 F     flavus        757
 5 F     fulvescens     57
 6 F     fulviventer    17
 7 F     hispidus       99
 8 F     leucogaster   475
 9 F     leucopus       16
10 F     maniculatus   382
# … with 71 more rows</code></pre>
</div>
</div>
<hr>
<p>With the above code, we can then use <code>arrange()</code> to sort the table according to a number of criteria so that we have a better comparison.</p>
<p>For instance, we might want to arrange the table above in</p>
<ul>
<li><ol type="i">
<li>an alphabetical order of the levels of the species</li>
</ol></li>
<li><ol start="2" type="i">
<li>in descending order of the count</li>
</ol></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">count</span>(sex, species) <span class="sc">%&gt;%</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(species, <span class="fu">desc</span>(n)) <span class="co">#n is the column name of the counts output from the count command, so it's used here to define the decreasing on value</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 81 × 3
   sex   species             n
   &lt;chr&gt; &lt;chr&gt;           &lt;int&gt;
 1 F     albigula          675
 2 M     albigula          502
 3 &lt;NA&gt;  albigula           75
 4 &lt;NA&gt;  audubonii          75
 5 F     baileyi          1646
 6 M     baileyi          1216
 7 &lt;NA&gt;  baileyi            29
 8 &lt;NA&gt;  bilineata         303
 9 &lt;NA&gt;  brunneicapillus    50
10 &lt;NA&gt;  chlorurus          39
# … with 71 more rows</code></pre>
</div>
</div>
<p>From the table above, we may learn that, for instance, there are 75 observations of the <em>albigula</em> species that are not specified for its sex (i.e.&nbsp;<code>NA</code>).</p>
<hr>
<section id="challenge-2" class="level4">
<h4 class="anchored" data-anchor-id="challenge-2">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Using <code>survey</code>, how many animals were caught in each <code>plot_type</code> surveyed?</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(plot_type)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 5 × 2
  plot_type                     n
  &lt;chr&gt;                     &lt;int&gt;
1 Control                   15611
2 Long-term Krat Exclosure   5118
3 Rodent Exclosure           4233
4 Short-term Krat Exclosure  5906
5 Spectab exclosure          3918</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="challenge-3" class="level4">
<h4 class="anchored" data-anchor-id="challenge-3">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Starting with <code>survey</code>, use <code>group_by()</code> and <code>summarize()</code> to find the mean, min, and max hindfoot length for each species (using <code>species_id</code>). Also add the number of observations (hint: see <code>?n</code>).</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-6-contents" aria-controls="callout-6" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-6" class="callout-6-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(hindfoot_length)) <span class="sc">%&gt;%</span> <span class="co">#remove NAs</span></span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(species_id) <span class="sc">%&gt;%</span> <span class="co">#group by species</span></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">summarize</span>( <span class="co">#give me this output/table with the following</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>      <span class="at">mean_val =</span> <span class="fu">mean</span>(hindfoot_length), <span class="co">#mean_cal column, computing the mean on column x</span></span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>      <span class="at">min_val =</span> <span class="fu">min</span>(hindfoot_length), <span class="co">#min_cal column, computing the min on column x</span></span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">max_val =</span> <span class="fu">max</span>(hindfoot_length), <span class="co">#max_cal column, computing the max on column x</span></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a>      <span class="at">n =</span> <span class="fu">n</span>()) <span class="co">#gives number of current groups size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 25 × 5
   species_id mean_val min_val max_val     n
   &lt;chr&gt;         &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt; &lt;int&gt;
 1 AH             33        31      35     2
 2 BA             13         6      16    45
 3 DM             36.0      16      50  9972
 4 DO             35.6      26      64  2887
 5 DS             49.9      39      58  2132
 6 NL             32.3      21      70  1074
 7 OL             20.5      12      39   920
 8 OT             20.3      13      50  2139
 9 OX             19.1      13      21     8
10 PB             26.1       2      47  2864
# … with 15 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="challenge-4" class="level4">
<h4 class="anchored" data-anchor-id="challenge-4">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Starting with <code>survey</code>, what was the heaviest animal measured in each year? Return the columns <code>year</code>, <code>genus</code>, <code>species_id</code>, and <code>weight</code>.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>surveys <span class="sc">%&gt;%</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span> <span class="co">#filter out NA</span></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">group_by</span>(year) <span class="sc">%&gt;%</span> <span class="co">#group by species</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(weight <span class="sc">==</span> <span class="fu">max</span>(weight)) <span class="sc">%&gt;%</span> <span class="co">#select the max weight rows for each year, save to weight column</span></span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">select</span>(year, genus, species, weight) <span class="sc">%&gt;%</span> <span class="co">#select specific columns of interest</span></span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">arrange</span>(year) <span class="co">#arrange in ascending order by year</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 27 × 4
# Groups:   year [26]
    year genus     species     weight
   &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;        &lt;dbl&gt;
 1  1977 Dipodomys spectabilis    149
 2  1978 Neotoma   albigula       232
 3  1978 Neotoma   albigula       232
 4  1979 Neotoma   albigula       274
 5  1980 Neotoma   albigula       243
 6  1981 Neotoma   albigula       264
 7  1982 Neotoma   albigula       252
 8  1983 Neotoma   albigula       256
 9  1984 Neotoma   albigula       259
10  1985 Neotoma   albigula       225
# … with 17 more rows</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="tidy-data" class="level3">
<h3 class="anchored" data-anchor-id="tidy-data">Tidy data</h3>
<p>Structuring data is an important aspect of working with data, making it easier to analyze and visualize. The best way to work with our data is in “tidy” format.</p>
<div id="fig-tidy" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../images/tidydata_1.jpg" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;1: Rules to form tidy data. [2]</figcaption><p></p>
</figure>
</div>
<hr>
</section>
<section id="reshaping-with-pivot_longer-and-pivot_wider" class="level3">
<h3 class="anchored" data-anchor-id="reshaping-with-pivot_longer-and-pivot_wider">Reshaping with <code>pivot_longer()</code> and <code>pivot_wider()</code></h3>
<p>When working with tidy data there are two common dataformats for tabular datasets, wide and long.</p>
<p>In the example below we collected information on 3 variables – site, year, and cases.</p>
<p>Wide</p>
<ul>
<li>Data relating to the same measured thing in different columns.</li>
<li>In this case, we have values related to our “metric” spread across multiple columns (a column each for a year).</li>
</ul>
<p>Long</p>
<ul>
<li>A column for each of the types of things we measured or recorded in our data.</li>
<li>In other words, each variable has its own column (a column for site, year, and case).</li>
</ul>
<div id="fig-wide-long" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../images/wide-tidy.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;2: Examples of wide (left) and long (right) data. [2]</figcaption><p></p>
</figure>
</div>
<hr>
<p>Depending on what you want do to, you might want to reshape from one form to the other. Luckily, there are functions for the <code>pivot_wider()</code> and <code>pivot_longer()</code>.</p>
<div id="fig-wide-long-transition" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../images/tidyr-pivot_wider_longer.gif" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;3: Pivoting from wide to long formatted data. [1]</figcaption><p></p>
</figure>
</div>
<hr>
<section id="pivoting-from-long-to-wide-format" class="level4">
<h4 class="anchored" data-anchor-id="pivoting-from-long-to-wide-format">Pivoting from long to wide format</h4>
<p><code>pivot_wider()</code> takes three principal arguments</p>
<ol type="1">
<li>the data</li>
<li>the <em>names_from</em> column variable whose values will become new column names.</li>
<li>the <em>values_from</em> column variable whose values will fill the new column variables.</li>
</ol>
<p>Further arguments include <code>values_fill</code> which, if set, fills in missing values with the value provided.</p>
<hr>
<p>What if we wanted to plot comparisons between the weight of genera in different plots?</p>
<p>To do this, we’ll need to 1. Create our dataset of interest – will generate a long formatted dataframe 2. Convert from long to wide format, filling missing values with <code>0</code>.</p>
<p>Create our dataset – use <code>filter()</code>, <code>group_by()</code> and <code>summarize()</code> to filter our observations and variables of interest, and create a new variable for the <code>mean_weight</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>surveys_gw <span class="ot">&lt;-</span> surveys <span class="sc">%&gt;%</span> </span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight)) <span class="sc">%&gt;%</span> <span class="co">#remove rows with empty weight</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(plot_id, genus) <span class="sc">%&gt;%</span> <span class="co">#group by plot_id and genus</span></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean_weight =</span> <span class="fu">mean</span>(weight)) <span class="co">#give me the mean weight for each group</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'plot_id'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(surveys_gw)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   plot_id [1]
  plot_id genus       mean_weight
    &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1       1 Baiomys            7   
2       1 Chaetodipus       22.2 
3       1 Dipodomys         60.2 
4       1 Neotoma          156.  
5       1 Onychomys         27.7 
6       1 Perognathus        9.62</code></pre>
</div>
</div>
<p>This yields <code>surveys_gw</code>, a long-formatted dataframe where the observations for each plot are distributed across multiple rows, 196 observations of 3 variables.</p>
<hr>
<p>Let’s use <code>pivot_wider()</code> as follows</p>
<ul>
<li><code>data</code> – the <code>surveys_gw</code> dataframe</li>
<li><code>names_from</code> – <code>genus</code> (column variable whose values will become new column names)</li>
<li><code>values_from</code> – <code>mean_weight</code> (column variable whose values will fill the new column variables)</li>
</ul>
<p>Using <code>pivot_wider()</code> with the names from <code>genus</code> and with values from <code>mean_weight</code> this becomes 24 observations of 11 variables, one row for each plot.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>surveys_wide <span class="ot">&lt;-</span> surveys_gw <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> genus, <span class="at">values_from =</span> mean_weight, <span class="at">values_fill =</span> <span class="dv">0</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(surveys_wide)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 11
# Groups:   plot_id [6]
  plot_id Baiomys Chaetodipus Dipodomys Neotoma Onycho…¹ Perog…² Perom…³ Reith…⁴
    &lt;dbl&gt;   &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;
1       1    7           22.2      60.2    156.     27.7    9.62    22.2    11.4
2       2    6           25.1      55.7    169.     26.9    6.95    22.3    10.7
3       3    8.61        24.6      52.0    158.     26.0    7.51    21.4    10.5
4       4    0           23.0      57.5    164.     28.1    7.82    22.6    10.3
5       5    7.75        18.0      51.1    190.     27.0    8.66    21.2    11.2
6       6    0           24.9      58.6    180.     25.9    7.81    21.8    10.7
# … with 2 more variables: Sigmodon &lt;dbl&gt;, Spermophilus &lt;dbl&gt;, and abbreviated
#   variable names ¹​Onychomys, ²​Perognathus, ³​Peromyscus, ⁴​Reithrodontomys</code></pre>
</div>
</div>
<div id="fig-wide" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../images/pivot_wider_graphic.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;4: From long to wide format. [1]</figcaption><p></p>
</figure>
</div>
<hr>
</section>
<section id="pivoting-from-wide-to-long-format" class="level4">
<h4 class="anchored" data-anchor-id="pivoting-from-wide-to-long-format">Pivoting from wide to long format</h4>
<p>What if we wanted were given a wide format, but wanted to treat the genus names (which are column names) as values of a genus variable instead (we wanted a genus column)?</p>
<p><code>pivot_longer()</code> takes four principal arguments:</p>
<ol type="1">
<li>the data</li>
<li>the <em>names_to</em> column variable we wish to create from column names.</li>
<li>the <em>values_to</em> column variable we wish to create and fill with values.</li>
<li><em>cols</em> are the name of the columns we use to make this pivot (or to drop).</li>
</ol>
<hr>
<p>Let’s use <code>pivot_longer()</code> as follows</p>
<ul>
<li><code>data</code> – the <code>surveys_wide</code> dataframe</li>
<li><code>names_to</code> – <code>genus</code> (column variable to create from column names)</li>
<li><code>values_to</code> – <code>mean_weight</code> (column variable we wish to create and fill with values)</li>
<li><code>cols</code> – <code>-plot_id</code> (names of columns we use to make the pivot or drop)</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>surveys_long <span class="ot">&lt;-</span> surveys_wide <span class="sc">%&gt;%</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"genus"</span>, <span class="at">values_to =</span> <span class="st">"mean_weight"</span>, <span class="at">cols =</span> <span class="sc">-</span>plot_id) <span class="co">#were including all cols here except plot_id</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(surveys_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   plot_id [1]
  plot_id genus       mean_weight
    &lt;dbl&gt; &lt;chr&gt;             &lt;dbl&gt;
1       1 Baiomys            7   
2       1 Chaetodipus       22.2 
3       1 Dipodomys         60.2 
4       1 Neotoma          156.  
5       1 Onychomys         27.7 
6       1 Perognathus        9.62</code></pre>
</div>
</div>
<div id="fig-long" class="quarto-figure quarto-figure-center anchored">
<figure class="figure">
<p><img src="../images/pivot_longer_graphic.png" class="img-fluid figure-img"></p>
<p></p><figcaption class="figure-caption">Figure&nbsp;5: From wide to long format. [1]</figcaption><p></p>
</figure>
</div>
<hr>
</section>
<section id="challenge-5" class="level4">
<h4 class="anchored" data-anchor-id="challenge-5">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Reshape the <code>surveys</code> dataframe with <code>year</code> as columns, <code>plot_id</code> as rows, and the number of genera per plot as the values.</p>
<p>You will need to summarize before reshaping, and use the function <code>n_distinct()</code> to get the number of unique genera within a particular chunk of data. It’s a powerful function! See <code>?n_distinct</code> for more.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-8-contents" aria-controls="callout-8" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-8" class="callout-8-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>Year is spread across columns, so we need a wide format.</p>
<ul>
<li>each row will have a distinct <code>plot_id</code></li>
<li>the value will be the genera per plot, for each year – which we need to calculate</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>surveys_wide_genera <span class="ot">&lt;-</span> surveys <span class="sc">%&gt;%</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(plot_id, year) <span class="sc">%&gt;%</span> <span class="co">#group by plot_id and year</span></span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n_genera =</span> <span class="fu">n_distinct</span>(genus)) <span class="sc">%&gt;%</span> <span class="co">#count number of distinct genera, create column</span></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> year, <span class="at">values_from =</span> n_genera) <span class="co">#pivot to wide format, where names from year, and values from number of unique genera</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>`summarise()` has grouped output by 'plot_id'. You can override using the
`.groups` argument.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(surveys_wide_genera)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 27
# Groups:   plot_id [6]
  plot_id `1977` `1978` `1979` `1980` `1981` `1982` `1983` `1984` `1985` `1986`
    &lt;dbl&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;
1       1      2      3      4      7      5      6      7      6      4      3
2       2      6      6      6      8      5      9      9      9      6      4
3       3      5      6      4      6      6      8     10     11      7      6
4       4      4      4      3      4      5      4      6      3      4      3
5       5      4      3      2      5      4      6      7      7      3      1
6       6      3      4      3      4      5      9      9      7      5      6
# … with 16 more variables: `1987` &lt;int&gt;, `1988` &lt;int&gt;, `1989` &lt;int&gt;,
#   `1990` &lt;int&gt;, `1991` &lt;int&gt;, `1992` &lt;int&gt;, `1993` &lt;int&gt;, `1994` &lt;int&gt;,
#   `1995` &lt;int&gt;, `1996` &lt;int&gt;, `1997` &lt;int&gt;, `1998` &lt;int&gt;, `1999` &lt;int&gt;,
#   `2000` &lt;int&gt;, `2001` &lt;int&gt;, `2002` &lt;int&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="challenge-6" class="level4">
<h4 class="anchored" data-anchor-id="challenge-6">Challenge</h4>
<div class="panel-input card bg-light p-2">
<p><em><strong>Q&amp;A</strong></em>: Now take that data frame and <code>pivot_longer()</code> it, so each row is a unique <code>plot_id</code> by <code>year</code> combination.</p>
<div class="callout-note callout callout-style-default no-icon callout-captioned">
<div class="callout-header d-flex align-content-center" data-bs-toggle="collapse" data-bs-target=".callout-9-contents" aria-controls="callout-9" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon no-icon"></i>
</div>
<div class="callout-caption-container flex-fill">
<em>Click here for the answer</em>
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-9" class="callout-9-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The current column values are <code>plot_id</code>, and a large range of years.</p>
<ul>
<li>names_to will be <code>year</code> – creating a <code>year</code> column</li>
<li>values_to will be <code>n_genera</code> – creating a <code>n_genera</code> column, putting the individual cell values in this</li>
<li>the columns to reshape/pivot on (<code>cols</code>) will be the year columns, so <code>-plot_id</code> to select all but <code>plot_id</code></li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>surveys_long <span class="ot">&lt;-</span> surveys_wide_genera <span class="sc">%&gt;%</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">names_to =</span> <span class="st">"year"</span>, <span class="at">values_to =</span> <span class="st">"n_genera"</span>, <span class="at">cols =</span> <span class="sc">-</span>plot_id)</span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(surveys_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
# Groups:   plot_id [1]
  plot_id year  n_genera
    &lt;dbl&gt; &lt;chr&gt;    &lt;int&gt;
1       1 1977         2
2       1 1978         3
3       1 1979         4
4       1 1980         7
5       1 1981         5
6       1 1982         6</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="exporting-data" class="level3">
<h3 class="anchored" data-anchor-id="exporting-data">Exporting data</h3>
<p>After analyzing, processing data, we often want to export the results to a file.</p>
<p>Let’s create a cleaned up version of our dataset that does not include missing data (<code>weight</code>, <code>hindfoot_length</code>, and <code>sex</code>) – in preparation for next session.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>surveys_complete <span class="ot">&lt;-</span> surveys <span class="sc">%&gt;%</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(weight),           <span class="co"># remove missing weight</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(hindfoot_length),  <span class="co"># remove missing hindfoot_length</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a>         <span class="sc">!</span><span class="fu">is.na</span>(sex))                <span class="co"># remove missing sex</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>We’re going to be plotting species abundances over time – so let’s remove observations for rare species (that have been observed less than 50 times).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb77"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Extract the common species_id</span></span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>species_counts <span class="ot">&lt;-</span> surveys_complete <span class="sc">%&gt;%</span></span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">count</span>(species_id) <span class="sc">%&gt;%</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">filter</span>(n <span class="sc">&gt;=</span> <span class="dv">50</span>)</span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="do">## Use the common species id as a key for filtering (keeping)</span></span>
<span id="cb77-7"><a href="#cb77-7" aria-hidden="true" tabindex="-1"></a>surveys_complete <span class="ot">&lt;-</span> surveys_complete <span class="sc">%&gt;%</span></span>
<span id="cb77-8"><a href="#cb77-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(species_id <span class="sc">%in%</span> species_counts<span class="sc">$</span>species_id) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p>To make sure that everyone has the same dataset, check the dimensions by typing <code>dim(surveys_complete)</code>, with values matching the output shown.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(surveys_complete)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30463    13</code></pre>
</div>
</div>
<hr>
<p>Now, let’s write to a file with <code>write_csv()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write_csv</span>(surveys_complete, <span class="at">file =</span> <span class="st">"~/data-carpentry/data/surveys_complete.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
</section>
<section id="citations" class="level3">
<h3 class="anchored" data-anchor-id="citations">Citations</h3>
<ol type="1">
<li>Data Analysis and Visualization in R for Ecologists. <a href="https://datacarpentry.org/R-ecology-lesson/index.html" class="uri">https://datacarpentry.org/R-ecology-lesson/index.html</a></li>
<li>Wickham, H. Tidy Data. Journal of Statistical Software 59 (10). <a href="https://10.18637/jss.v059.i10" class="uri">https://10.18637/jss.v059.i10</a></li>
</ol>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation column-body">
  <div class="nav-page nav-page-previous">
      <a href="../2-Intro-to-R/starting-with-data.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Starting with data</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../2-Intro-to-R/data-visualization.html" class="pagination-link">
        <span class="nav-page-text">Data visualization with ggplot2</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
<footer class="footer">
  <div class="nav-footer">
      <div class="nav-footer-center"><div class="cookie-consent-footer"><a href="#" id="open_preferences_center">Cookie Preferences</a></div></div>
  </div>
</footer>



<script src="../site_libs/quarto-html/zenscroll-min.js"></script>
</body></html>